#!/bin/sh
#
# This file is released under the terms of the Artistic License.
# Please see the file LICENSE, included in this package, for details.
#
# Copyright (C) 2002     Open Source Development Lab, Inc.
#               2002     Jenny Zhang
#               2014     Mark Wong
#               2014     2ndQuadrant, Ltd.
#

export DBT3_DIR=${HOME}/local/dbt3
export PGHOME=@PGSQL_PATH@

export SID=dbt3
export DBNAME=${SID}
export PGDATA=${DBT3_DIR}/pgdata

# To set the pg_xlog directory, uncomment and modify appropriately.
#export PGXLOG_ARG="-X /mnt/pg_xlog"

export DBPORT=5432

export DEFAULT_LOAD_PARAMETERS=""
export DEFAULT_POWER_PARAMETERS=""
export DEFAULT_THROUGHPUT_PARAMETERS=""

# Directory with tablespace mount points, if using tablespaces.
export TSDIR=${DBT3_DIR}

export PATH=${PATH}:${PGHOME}/bin

clear_time_statistics() {
	@PSQL@ -v ON_ERROR_STOP=1 -X -q -p ${DBPORT} -d ${SID} \
			<< __EOF__ > /dev/null 2>&1
TRUNCATE TABLE time_statistics;
__EOF__
	return $?
}

record_start() {
	NAME=$1
	@PSQL@ -v ON_ERROR_STOP=1 -X -q -p ${DBPORT} -d ${SID} \
			<< __EOF__ > /dev/null 2>&1
INSERT INTO time_statistics (task_name, s_time)
VALUES ('$NAME', CURRENT_TIMESTAMP);
__EOF__
	return $?
}

record_end() {
	NAME=$1
	@PSQL@ -v ON_ERROR_STOP=1 -X -q -p ${DBPORT} -d ${SID} \
			<< __EOF__ > /dev/null 2>&1
UPDATE time_statistics
SET e_time = current_timestamp
WHERE task_name = '$NAME';
__EOF__
	return $?
}
