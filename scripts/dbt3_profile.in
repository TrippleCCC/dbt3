#!/bin/sh

#
# This file is released under the terms of the Artistic License.
# Please see # the file LICENSE, included in this package, for details.
#
# Copyright (C) 2002 Jenny Zhang & Open Source Development Lab, Inc.
#

DIR=`dirname $0`

export DBT3_HOME="@TOPDIR@"
export DATABASE=@DATABASE_TO_USE@

export DSS_QUERY="@TOPDIR@/queries/@DATABASE_TO_USE@"
export DSS_PATH="${HOME}/local/data"
export DSS_CONFIG="@TOPDIR@/src/dbgen"
export DBT3_PERL_MODULE="@TOPDIR@/perlmodules"

export DBGEN="${DSS_CONFIG}/dbgen"
export GTIME="@TOPDIR@/src/gtime"
export QGEN="${DSS_CONFIG}/qgen"
export PARSE_QUERY="@TOPDIR@/src/parse_query"
export POWER="@TOPDIR@/src/power"

source @TOPDIR@/scripts/${DATABASE}/${DATABASE}_profile

perf_start()
{
	DIR=${1}

	mkdir -p ${DIR}
	sudo perf record -o ${DIR}/perf.data -a -g -s sleep 60
}

perf_collect()
{
	DIR=${1}

	echo "Generating perf report..."
	sudo perf report -i ${DIR}/perf.data -n > ${DIR}/perf-report.txt &

	echo "Generating perf annotated source..."
	sudo perf annotate -l -P -i ${DIR}/perf.data > ${DIR}/perf-annotate.txt &

	echo "Generating perf trace on..."
	sudo perf script -L -i ${DIR}/perf.data > ${DIR}/perf-trace.txt &
}
